<div id="quest-container"></div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://your-supabase-url.supabase.co";
  const SUPABASE_ANON_KEY = "your-anon-key";
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  document.addEventListener("DOMContentLoaded", function () {
    const questData = {
      quest_code: "onboarding",
      title: "Complete Your Onboarding Quest!",
      tasks: [
        { name: "Enter your Discord Username", type: "discord", requiresAnswer: true, placeholder: "e.g. User#1234" },
        { name: "Enter your Twitter Username", type: "twitter", requiresAnswer: true, placeholder: "e.g. @user123" }
      ],
      bannerImage: "https://your-onboarding-banner.png"
    };

    function renderQuest(quest) {
      const container = document.getElementById("quest-container");
      container.innerHTML = `
        <div style="border: 2px solid #444; padding: 15px; border-radius: 10px; width: 400px; background: #1a1a1a; color: white; text-align: center;">
          <img src="${quest.bannerImage}" style="width: 100%; border-radius: 10px 10px 0 0;">
          <h2>${quest.title}</h2>
          ${quest.tasks.map((task, index) => `
            <div style="margin: 5px 0;">
              <span>${task.name}</span>
              <input type="text" id="task-input-${index}" placeholder="${task.placeholder}" style="width: 90%; padding: 5px;">
            </div>
          `).join("")}
          <button id="submit-btn" onclick="submitQuest()">Submit</button>
          <p id="message"></p>
        </div>
      `;
    }

    async function submitQuest() {
      const discord = document.getElementById("task-input-0").value.trim();
      const twitter = document.getElementById("task-input-1").value.trim();
      if (!discord || !twitter) {
        document.getElementById("message").textContent = "Please fill in all fields.";
        return;
      }

      const { error } = await supabase.from("quest_submissions_pending").insert([
        { quest_code: "onboarding", user_identifier: discord, task_type: "discord", response: discord, status: null },
        { quest_code: "onboarding", user_identifier: twitter, task_type: "twitter", response: twitter, status: null }
      ]);

      document.getElementById("message").textContent = error ? "Error submitting!" : "Submitted for review!";
    }

    renderQuest(questData);
  });
</script>
